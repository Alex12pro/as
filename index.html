<script type="module">
  // ===== Elements =====
  const urlInput = document.getElementById("urlInput");
  const browserFrame = document.getElementById("browserFrame");
  const welcomeScreen = document.getElementById("welcomeScreen");
  const goBtn = document.getElementById("goBtn");
  const backBtn = document.getElementById("backBtn");
  const forwardBtn = document.getElementById("forwardBtn");
  const refreshBtn = document.getElementById("refreshBtn");
  const homeBtn = document.getElementById("homeBtn");
  const quickCard = document.querySelector(".quick-card");

  // ===== Helpers =====
  function isURL(text) {
    return /^(https?:\/\/)?([\w-]+\.)+[\w-]+/i.test(text);
  }

  function buildProxyURL(input) {
    if (!input) return null;

    let target;
    if (isURL(input)) {
      target = input.startsWith("http") ? input : "https://" + input;
    } else {
      // Brave search
      target = "https://search.brave.com/search?q=" + encodeURIComponent(input);
    }

    return "/p?u=" + encodeURIComponent(target);
  }

  // ===== Navigation =====
  function navigate(input) {
    const proxyURL = buildProxyURL(input);
    if (!proxyURL) return;

    // Hide home UI
    welcomeScreen.style.display = "none";

    // Show iframe
    browserFrame.classList.add("active");
    browserFrame.style.display = "block";
    browserFrame.src = proxyURL;
  }

  function goHome() {
    // Hide iframe completely
    browserFrame.classList.remove("active");
    browserFrame.style.display = "none";
    browserFrame.src = "about:blank";

    // Show home UI exactly as designed
    welcomeScreen.style.display = "flex";

    // Reset input
    urlInput.value = "";

    // Safety scroll reset
    window.scrollTo(0, 0);
  }

  // ===== Top Bar =====
  goBtn.addEventListener("click", () => navigate(urlInput.value));

  urlInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      navigate(urlInput.value);
    }
  });

  backBtn.addEventListener("click", () => {
    try {
      browserFrame.contentWindow.history.back();
    } catch {}
  });

  forwardBtn.addEventListener("click", () => {
    try {
      browserFrame.contentWindow.history.forward();
    } catch {}
  });

  refreshBtn.addEventListener("click", () => {
    try {
      browserFrame.contentWindow.location.reload();
    } catch {}
  });

  homeBtn.addEventListener("click", goHome);

  // ===== Home Quick Card =====
  if (quickCard) {
    quickCard.addEventListener("click", () => {
      navigate("brave");
    });
  }
</script>
